var tc = "乾亞來侖係倉倫偉傑傘備傳僅僑儀億儉優儲兒內兩凍凱別則創劃劇劉劍勁務勛勝勞勢勳勵勸匯區協吳呂員問啞啟啣喬單噴嚨囉國圍園圓團垵執堅堯場塊塗塢塹墜墻墾壇壘壟壠壢壩壯壽夢奐奮媽嬰孫學宮實寧寬寶將專對導層岡島峽崑崗崙崠嵐嶺嶼巒巖師帳帶幹庫廈廚廟廠廣廩廬廳張強彈彌彎後徑復恆恥悅愛慶憲懇應懷戲戶掃掛揚撫擁擔擴擷擺攔攤敘斷昇時晉暉暢曉會東柵梘條棟棧棲楊楓業極榮槓樁樂樓樹橋機橫檜檢檳櫃櫻欄權欖歐歡歲歷歸殼氣汎涼淒淨淵淺渾湧湯溝溫滬滾滿漁漢潔潤澗澤濁濃濕濟濤濫濱瀋瀧瀨瀰瀾灘灣灧為烏無煙煥熱燄燈燒營燦燭爐爺爾狀獅獨獻現瑤瑪璉環瓊甕產畝疊發監盤盧盪眾砲硤碼磐磚磯礦祐祿禎禪禮稅稜稟種穀穎窩窯窰竪筆筍筧箋節範築篤簡籃籐籠籬粵糞紀約紅納純紗紙紹絃組結絨統綏經綜綠維網綸綺綿緘線緝緯練縣總繞繼纘羅義習翬聖聞聯聲聳職聽肅脈腦腳臥臨臺興舉舊舖舘苧莊華菸萊萬葉葯蒼蓀蓆蓋蓮蔣蔦蔭蔴蕭薑薰藍藝藥蘆蘇蘭處號術衛補裡見規親覺觀觸訊訓記設許詔試詩誠誼調諒論謙講謝護譽變讚谿豎豐豬貓貝貞負財貢貨販貫責貴貿賀資賓賜賞賢賦賴賽贊跡踐車軍軒軟載輔輕輜輝輦輪轅轉辭農迴連進遊運過達遠遼還邊郵鄉鄒鄧鄭鄰醫針釣鈀鈎鈴銀銃銅銑銘鋁鋒鋪鋼錏錠錢錦錫鍋鍾鎖鎮鎰鏞鏡鐘鐵鐸鑼鑽鑾長門閂開閑閒間閔閣閤閩闊關陝陰陳陸陽際隨隱隴雙雞難雲電霧靜韋韜頂順領頭頸顏顧顯風飛飯餉養館饒馬駕駝騎騰驗驛體鬥鬧鬮魚魯鮑鯉鯤鰲鱉鳥鳩鳳鳴鴨鴻鴿鵝鵠鵬鶯鶴鶿鷄鷗鷹鷺鸞鹹鹽麗麥黃點齊齋齒齡龍龔龜";
var sc = "干亚来仑系仓伦伟杰伞备传仅侨仪亿俭优储儿内两冻凯别则创划剧刘剑劲务勋胜劳势勋励劝汇区协吴吕员问哑启衔乔单喷咙啰国围园圆团埯执坚尧场块涂坞堑坠墙垦坛垒垄垄坜坝壮寿梦奂奋妈婴孙学宫实宁宽宝将专对导层冈岛峡昆岗仑岽岚岭屿峦岩师帐带干库厦厨庙厂广廪庐厅张强弹弥弯后径复恒耻悦爱庆宪恳应怀戏户扫挂扬抚拥担扩撷摆拦摊叙断升时晋晖畅晓会东栅枧条栋栈栖杨枫业极荣杠桩乐楼树桥机横桧检槟柜樱栏权榄欧欢岁历归壳气泛凉凄净渊浅浑涌汤沟温沪滚满渔汉洁润涧泽浊浓湿济涛滥滨渖泷濑弥澜滩湾滟为乌无烟焕热焰灯烧营灿烛炉爷尔状狮独献现瑶玛琏环琼瓮产亩迭发监盘卢荡众炮硖码盘砖矶矿佑禄祯禅礼税棱禀种谷颖窝窑窑竖笔笋笕笺节范筑笃简篮藤笼篱粤粪纪约红纳纯纱纸绍弦组结绒统绥经综绿维网纶绮绵缄线缉纬练县总绕继缵罗义习翚圣闻联声耸职听肃脉脑脚卧临台兴举旧铺馆苎庄华烟莱万叶药苍荪席盖莲蒋茑荫麻萧姜熏蓝艺药芦苏兰处号术卫补里见规亲觉观触讯训记设许诏试诗诚谊调谅论谦讲谢护誉变赞溪竖丰猪猫贝贞负财贡货贩贯责贵贸贺资宾赐赏贤赋赖赛赞迹践车军轩软载辅轻辎辉辇轮辕转辞农回连进游运过达远辽还边邮乡邹邓郑邻医针钓钯钩铃银铳铜铣铭铝锋铺钢铔锭钱锦锡锅钟锁镇镒镛镜钟铁铎锣钻銮长门闩开闲闲间闵阁合闽阔关陕阴陈陆阳际随隐陇双鸡难云电雾静韦韬顶顺领头颈颜顾显风飞饭饷养馆饶马驾驼骑腾验驿体斗闹阄鱼鲁鲍鲤鲲鳌鳖鸟鸠凤鸣鸭鸿鸽鹅鹄鹏莺鹤鹚鸡鸥鹰鹭鸾咸盐丽麦黄点齐斋齿龄龙龚龟";
var equivelent = ['0123456789','零一二三四五六七八九','０１２３４５６７８９'];
var ignore = " !@#$%^&*_+！￥……×";
/*
Implement Wagner–Fischer algorithm
http://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm
*/
function LevenshteinDistance(A,B,stop){
	prev = [];
	curr = [];
	for(var i = 0;i<A.length+1;i++){
		prev[i] = i;
	}
	for(var i = 0;i<B.length;i++){
		curr = [];
		curr[0] = i+1;
		for(var j = 0;j<A.length;j++){
			if(A[j] == B[i]){
				curr[j+1] = prev[j];
			}else{
				var sub = prev[j]+wsub(A[j],B[i]);//d[i-1,j-1]
				var ins = prev[j+1]+1;//d[i-1,j]
				var del = curr[j]+wins(B[i]);//d[i,j-1]
				curr[j+1] = sub<del?(sub<ins?sub:ins):(del<ins?del:ins);
			}
		}
		if(Math.min.apply(this,curr)>=stop){
			return -1;
		}
		prev = null;
		prev = curr;
	}
	return curr[curr.length-1];
}

function wins(a){
	var idx = ignore.indexOf(a);
	return idx===-1?1:0;
}

function wsub(a,b){
	var idx = tc.indexOf(a);
	if(idx>=0){
		//deal with simplified chinese
		return b===sc[idx]?0:1;
	}else{
		//deal with numbers
		var ad = -1;
		for (var i = 0; i < equivelent.length; i++) {
			ad = equivelent[i].indexOf(a);
			if(ad>=0)break;
		};
		var bd = -1;
		for(var i=0;i<equivelent.length;i++){
			bd = equivelent[i].indexOf(b);
			if(bd>=0)break;
		}
		if(ad>=0 && bd>=0){
			return ad==bd?0.2:1;	
		} 
		return 1;
	}
}

function FuzzyQuery(t){
	if(pool===undefined || database==undefined)throw 'no local database';
	var res=[];
	var min = t.length>30?t.length:30;
	for(var d in database){
		o = database[d];
		var full = o.city+o.area+o.road;
		var result = LevenshteinDistance(full,t,min);
		if(result>=0 && result<=min){
			res.push([d,result]);
			min = result;
		}
	}
	res.sort(function(a,b){return a[1]-b[1];});
	res = res.slice(0,15);
	console.log(res);
	return res;
}